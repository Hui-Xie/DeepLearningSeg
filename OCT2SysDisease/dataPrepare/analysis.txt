Hypertension data: 1: 1915; 0: 1535
input: 62-OCT
output: {0,1}

age range: [50,91], total 42 ranges


plan data division:
    training,   validation,    test,    sum
0,    1075  ,        230,     230,    1535
1,    1341  ,        287,     287,    1915
sum,  2416  ,        517,     517,    3450

Real data division according to hypertension:
    training,   validation,    test,    sum
0,    1007  ,        264,     264,    1535
1,    1257  ,        329,     329,    1915
sum,  2264  ,        593,     593,    3450

perAgeRange choice:
0,                    5-6       5-6
1,                    6-7       6-7

==========================================================================
=============Check Volumes and Clinical ID correspondence================
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/testID.csv
total 593 IDs in /home/hxie1/data/BES_3K/GTs/testID.csv
total 3288 OD volumes in /home/hxie1/data/BES_3K/raw
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/563_OD_5953_Volume', '/home/hxie1/data/BES_3K/raw/563_OD_5957_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1426_OD_16481_Volume', '/home/hxie1/data/BES_3K/raw/1426_OD_16511_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6892_OD_22210_Volume', '/home/hxie1/data/BES_3K/raw/6892_OD_27754_Volume']
find 560 corresponding volumes with ID
NonExistIDList: ['294', '365', '526', '528', '651', '1303', '1988', '2242', '2449', '3622', '4087', '4092', '4149', '4943', '5874', '6002', '6304', '6973', '32085', '34030', '34132', '34176', '110016', '110162', '110177', '110186', '110187', '120074', '170079', '170088']
total 30 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/validationID.csv
total 593 IDs in /home/hxie1/data/BES_3K/GTs/validationID.csv
total 3288 OD volumes in /home/hxie1/data/BES_3K/raw
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/82_OD_2614_Volume', '/home/hxie1/data/BES_3K/raw/82_OD_2791_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/179_OD_4915_Volume', '/home/hxie1/data/BES_3K/raw/179_OD_4914_Volume', '/home/hxie1/data/BES_3K/raw/179_OD_4907_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1703_OD_16532_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16571_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16531_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16582_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16585_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5191_OD_29751_Volume', '/home/hxie1/data/BES_3K/raw/5191_OD_29755_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34127_OD_24960_Volume', '/home/hxie1/data/BES_3K/raw/34127_OD_26784_Volume']
find 548 corresponding volumes with ID
NonExistIDList: ['88', '92', '203', '284', '1264', '1962', '1989', '2845', '4009', '4016', '4030', '4070', '4079', '4125', '4498', '4783', '4801', '4856', '4937', '4938', '4949', '5146', '5470', '5542', '5745', '6278', '6966', '32153', '33085', '34133', '34168', '34632', '110015', '120037', '120051', '120087', '120174', '170065', '170075', '170222']
total 40 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/trainID.csv
total 2264 IDs in /home/hxie1/data/BES_3K/GTs/trainID.csv
total 3288 OD volumes in /home/hxie1/data/BES_3K/raw
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/123_OD_25375_Volume', '/home/hxie1/data/BES_3K/raw/123_OD_1936_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/378_OD_954_Volume', '/home/hxie1/data/BES_3K/raw/378_OD_958_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/600_OD_4409_Volume', '/home/hxie1/data/BES_3K/raw/600_OD_4480_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/773_OD_5087_Volume', '/home/hxie1/data/BES_3K/raw/773_OD_5100_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1064_OD_8896_Volume', '/home/hxie1/data/BES_3K/raw/1064_OD_8892_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1070_OD_25149_Volume', '/home/hxie1/data/BES_3K/raw/1070_OD_16613_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1296_OD_9602_Volume', '/home/hxie1/data/BES_3K/raw/1296_OD_24884_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1536_OD_11367_Volume', '/home/hxie1/data/BES_3K/raw/1536_OD_11364_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1690_OD_15989_Volume', '/home/hxie1/data/BES_3K/raw/1690_OD_15976_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1947_OD_14086_Volume', '/home/hxie1/data/BES_3K/raw/1947_OD_13585_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/2293_OD_10524_Volume', '/home/hxie1/data/BES_3K/raw/2293_OD_10533_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/4479_OD_31798_Volume', '/home/hxie1/data/BES_3K/raw/4479_OD_31794_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/4973_OD_29833_Volume', '/home/hxie1/data/BES_3K/raw/4973_OD_29837_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5152_OD_25166_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25157_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25171_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25169_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25167_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25168_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5834_OD_16804_Volume', '/home/hxie1/data/BES_3K/raw/5834_OD_16797_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6049_OD_19216_Volume', '/home/hxie1/data/BES_3K/raw/6049_OD_20607_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6253_OD_20370_Volume', '/home/hxie1/data/BES_3K/raw/6253_OD_20367_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6963_OD_22638_Volume', '/home/hxie1/data/BES_3K/raw/6963_OD_22651_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/32009_OD_9268_Volume', '/home/hxie1/data/BES_3K/raw/32009_OD_12398_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/32132_OD_15813_Volume', '/home/hxie1/data/BES_3K/raw/32132_OD_15817_Volume', '/home/hxie1/data/BES_3K/raw/32132_OD_15812_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/33019_OD_7226_Volume', '/home/hxie1/data/BES_3K/raw/33019_OD_7229_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34174_OD_31686_Volume', '/home/hxie1/data/BES_3K/raw/34174_OD_31683_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34540_OD_27868_Volume', '/home/hxie1/data/BES_3K/raw/34540_OD_27872_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34623_OD_28790_Volume', '/home/hxie1/data/BES_3K/raw/34623_OD_28817_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/120090_OD_3733_Volume', '/home/hxie1/data/BES_3K/raw/120090_OD_8398_Volume']
find 2034 corresponding volumes with ID
NonExistIDList: ['60', '289', '290', '315', '328', '333', '341', '349', '357', '530', '576', '577', '592', '626', '671', '696', '719', '755', '756', '900', '910', '911', '969', '1088', '1213', '1217', '1340', '1342', '1353', '1354', '1461', '1476', '1482', '1513', '1532', '1587', '1616', '1642', '1647', '1675', '1676', '1719', '1720', '1724', '1763', '1794', '1802', '1870', '1940', '1968', '1969', '2011', '2014', '2035', '2036', '2045', '2057', '2061', '2092', '2100', '2101', '2106', '2107', '2112', '2120', '2121', '2122', '2123', '2128', '2150', '2157', '2200', '2207', '2243', '2261', '2392', '2411', '2422', '2426', '2428', '2450', '2455', '2466', '2573', '2574', '2594', '2671', '2681', '2698', '2743', '2753', '2775', '2864', '3603', '3604', '3606', '3609', '3621', '4014', '4039', '4049', '4078', '4082', '4083', '4114', '4117', '4145', '4152', '4174', '4221', '4241', '4262', '4296', '4318', '4372', '4413', '4523', '4811', '4857', '4892', '4895', '4916', '4941', '4942', '4945', '4948', '4994', '5024', '5047', '5110', '5200', '5213', '5546', '5728', '5830', '5835', '5897', '5984', '6093', '6300', '6649', '6679', '6782', '6843', '6869', '6982', '7019', '31026', '31034', '31038', '31143', '32056', '32059', '32102', '32106', '32115', '32123', '32131', '32133', '32148', '32151', '32152', '32154', '32160', '32161', '34045', '34136', '34553', '34613', '34626', '110002', '110009', '110010', '110018', '110062', '110074', '110115', '110128', '120004', '120007', '120008', '120015', '120041', '120059', '120104', '120112', '120116', '120146', '120153', '120155', '120161', '120180', '120198', '120225', '120245', '120253', '120258', '140014', '140015', '170069', '170083', '170084', '170097', '170098', '170117']
total 205 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
(base) [c-xwu000:dataPrepare]#

================================Tidy on Oct 2nd 2020===============

About the correspondence between clinical data and OD volume images.

Summary:
1  From the BES clinical excel file, there are 3450 IDs with hypertension ground truth {0,1};
2  5 original IDs use ????.1 float ID, Other use integer ID; (as Notes for future)
3  In above 3450 IDs, there are 275 IDs without corresponding OD volume images;
4  In above 3450 IDs, there are 33 IDs with multiple different OD volume images;
5  I directly do not use 275+33= 308 IDs , which make total data set of 3142 IDs for training, validation and test;
6  In 3142 patients: training 2034; validation 548; test 560;

ID list without OD volume images:
['60', '289', '290', '315', '328', '333', '341', '349', '357', '530', '576', '577', '592', '626', '671', '696', '719',
'755', '756', '900', '910', '911', '969', '1088', '1213', '1217', '1340', '1342', '1353', '1354', '1461', '1476', '1482',
'1513', '1532', '1587', '1616', '1642', '1647', '1675', '1676', '1719', '1720', '1724', '1763', '1794', '1802', '1870',
'1940', '1968', '1969', '2011', '2014', '2035', '2036', '2045', '2057', '2061', '2092', '2100', '2101', '2106', '2107',
'2112', '2120', '2121', '2122', '2123', '2128', '2150', '2157', '2200', '2207', '2243', '2261', '2392', '2411', '2422',
'2426', '2428', '2450', '2455', '2466', '2573', '2574', '2594', '2671', '2681', '2698', '2743', '2753', '2775', '2864',
'3603', '3604', '3606', '3609', '3621', '4014', '4039', '4049', '4078', '4082', '4083', '4114', '4117', '4145', '4152',
'4174', '4221', '4241', '4262', '4296', '4318', '4372', '4413', '4523', '4811', '4857', '4892', '4895', '4916', '4941',
'4942', '4945', '4948', '4994', '5024', '5047', '5110', '5200', '5213', '5546', '5728', '5830', '5835', '5897', '5984',
'6093', '6300', '6649', '6679', '6782', '6843', '6869', '6982', '7019', '31026', '31034', '31038', '31143', '32056',
'32059', '32102', '32106', '32115', '32123', '32131', '32133', '32148', '32151', '32152', '32154', '32160', '32161',
'34045', '34136', '34553', '34613', '34626', '110002', '110009', '110010', '110018', '110062', '110074', '110115',
'110128', '120004', '120007', '120008', '120015', '120041', '120059', '120104', '120112', '120116', '120146', '120153',
'120155', '120161', '120180', '120198', '120225', '120245', '120253', '120258', '140014', '140015', '170069', '170083',
'170084', '170097', '170098', '170117', '88', '92', '203', '284', '1264', '1962', '1989', '2845', '4009', '4016', '4030',
 '4070', '4079', '4125', '4498', '4783', '4801', '4856', '4937', '4938', '4949', '5146', '5470', '5542', '5745', '6278',
 '6966', '32153', '33085', '34133', '34168', '34632', '110015', '120037', '120051', '120087', '120174', '170065', '170075',
 '170222', '294', '365', '526', '528', '651', '1303', '1988', '2242', '2449', '3622', '4087', '4092', '4149', '4943',
 '5874', '6002', '6304', '6973', '32085', '34030', '34132', '34176', '110016', '110162', '110177', '110186', '110187',
 '120074', '170079', '170088']

Same ID has mulitple different OD volume images:
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/123_OD_25375_Volume', '/home/hxie1/data/BES_3K/raw/123_OD_1936_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/378_OD_954_Volume', '/home/hxie1/data/BES_3K/raw/378_OD_958_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/600_OD_4409_Volume', '/home/hxie1/data/BES_3K/raw/600_OD_4480_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/773_OD_5087_Volume', '/home/hxie1/data/BES_3K/raw/773_OD_5100_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1064_OD_8896_Volume', '/home/hxie1/data/BES_3K/raw/1064_OD_8892_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1070_OD_25149_Volume', '/home/hxie1/data/BES_3K/raw/1070_OD_16613_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1296_OD_9602_Volume', '/home/hxie1/data/BES_3K/raw/1296_OD_24884_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1536_OD_11367_Volume', '/home/hxie1/data/BES_3K/raw/1536_OD_11364_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1690_OD_15989_Volume', '/home/hxie1/data/BES_3K/raw/1690_OD_15976_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1947_OD_14086_Volume', '/home/hxie1/data/BES_3K/raw/1947_OD_13585_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/2293_OD_10524_Volume', '/home/hxie1/data/BES_3K/raw/2293_OD_10533_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/4479_OD_31798_Volume', '/home/hxie1/data/BES_3K/raw/4479_OD_31794_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/4973_OD_29833_Volume', '/home/hxie1/data/BES_3K/raw/4973_OD_29837_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5152_OD_25166_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25157_Volume',
                    '/home/hxie1/data/BES_3K/raw/5152_OD_25171_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25169_Volume',
                    '/home/hxie1/data/BES_3K/raw/5152_OD_25167_Volume', '/home/hxie1/data/BES_3K/raw/5152_OD_25168_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5834_OD_16804_Volume', '/home/hxie1/data/BES_3K/raw/5834_OD_16797_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6049_OD_19216_Volume', '/home/hxie1/data/BES_3K/raw/6049_OD_20607_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6253_OD_20370_Volume', '/home/hxie1/data/BES_3K/raw/6253_OD_20367_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6963_OD_22638_Volume', '/home/hxie1/data/BES_3K/raw/6963_OD_22651_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/32009_OD_9268_Volume', '/home/hxie1/data/BES_3K/raw/32009_OD_12398_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/32132_OD_15813_Volume', '/home/hxie1/data/BES_3K/raw/32132_OD_15817_Volume',
                    '/home/hxie1/data/BES_3K/raw/32132_OD_15812_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/33019_OD_7226_Volume', '/home/hxie1/data/BES_3K/raw/33019_OD_7229_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34174_OD_31686_Volume', '/home/hxie1/data/BES_3K/raw/34174_OD_31683_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34540_OD_27868_Volume', '/home/hxie1/data/BES_3K/raw/34540_OD_27872_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34623_OD_28790_Volume', '/home/hxie1/data/BES_3K/raw/34623_OD_28817_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/120090_OD_3733_Volume', '/home/hxie1/data/BES_3K/raw/120090_OD_8398_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/82_OD_2614_Volume', '/home/hxie1/data/BES_3K/raw/82_OD_2791_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/179_OD_4915_Volume', '/home/hxie1/data/BES_3K/raw/179_OD_4914_Volume',
                    '/home/hxie1/data/BES_3K/raw/179_OD_4907_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1703_OD_16532_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16571_Volume',
                   '/home/hxie1/data/BES_3K/raw/1703_OD_16531_Volume', '/home/hxie1/data/BES_3K/raw/1703_OD_16582_Volume',
                   '/home/hxie1/data/BES_3K/raw/1703_OD_16585_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/5191_OD_29751_Volume', '/home/hxie1/data/BES_3K/raw/5191_OD_29755_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/34127_OD_24960_Volume', '/home/hxie1/data/BES_3K/raw/34127_OD_26784_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/563_OD_5953_Volume', '/home/hxie1/data/BES_3K/raw/563_OD_5957_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/1426_OD_16481_Volume', '/home/hxie1/data/BES_3K/raw/1426_OD_16511_Volume']
Mulitple ID files: ['/home/hxie1/data/BES_3K/raw/6892_OD_22210_Volume', '/home/hxie1/data/BES_3K/raw/6892_OD_27754_Volume']

# ID name strange:
ID: 5320, and 5320.1; 6084 and 6084.1 are different patients

# original raw data contain .1 volume:
ls -ld *.*_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:29 2697.1_OD_7130_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:27 2697.1_OS_7136_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:32 4453.1_OD_23184_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:31 4453.1_OS_23187_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:30 4912.1_OD_30008_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:34 4912.1_OS_30012_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:25 5320.1_OD_26315_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:27 5320.1_OS_26320_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:32 6084.1_OD_17542_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:33 6084.1_OS_17546_Volume

As voluem image save in integer Id directory, all above *.1 ID change 9*1 ID, eg. 2697.1 -> 926971
modify:
1  modify clinincal data 5 rows in the BESClinicalGT_Analysis.xlsx
2  modify 10 volume name,eg. 2697.1 -> 926971;

below volumes are original *.1*_Volume:
[c-xwu000:raw]#ls -ld 9????1_*_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:29 926971_OD_7130_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:27 926971_OS_7136_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:32 944531_OD_23184_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:31 944531_OS_23187_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:30 949121_OD_30008_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:34 949121_OS_30012_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:25 953201_OD_26315_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:27 953201_OS_26320_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:32 960841_OD_17542_Volume
drwxr-xr-x 2 hxie1 Graduate-College-Students 4096 Jun 30 13:33 960841_OS_17546_Volume

Oct 2nd, 2020
Data division and basic statistics before coding:
below bracket() indicates patients number.

                    Training(2034)         Validation(548)     Test(560)
value               0,       1 ,          0,        1,       0,      1
hypertension:       44.4%  55.6%         44.9%     55.1%    44.3%   55.7%

                    1,       2 ,          1,        2,       1,       2
gender:             42.8%,  57.2%,       45.6%    54.4%,    45.4%,  54.6%


                      Training(2034)         Validation(548)            Test(560)
value               min,   avg,    max,      min,  avg,   max,         min, avg, max
age                 50,    64.0,   93,       50,   60.6,  88,          50,  64.5, 87


                       Training(1853)           Validation(547)              Test(560)
value               min,   avg,    max,      min,   avg,   max,         min,   avg,   max
AxialLength         18.96, 23.22, 30.88      19.39, 23.25, 30.69        21.09, 23.25, 26.76


                       Training(2033)           Validation(548)              Test(560)
value               min,   avg,    max,      min,   avg,   max,         min,   avg,   max
BP_Systolic:        78 ,   129 ,   217       74,    130,   216          70,    130,   205


                       Training(2034)           Validation(548)              Test(560)
value               min,   avg,    max,      min,   avg,   max,         min,   avg,   max
BP_Diastolic:       31,    69 ,    117       36,    69,    118          38,    70,   113


# Oct 3rd, 2020:
# check all volumes has 31 slices from the *_DelNonexist.csv list
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
total 2034 IDs in /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
total 3252 OD volumes in /home/hxie1/data/BES_3K/W512NumpyVolumes
find 2031 corresponding volumes with ID
NonExistIDList: ['574', '2750', '120035']
total 3 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_final.csv
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv
total 548 IDs in /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv
total 3252 OD volumes in /home/hxie1/data/BES_3K/W512NumpyVolumes
find 546 corresponding volumes with ID
NonExistIDList: ['358', '1207']
total 2 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_final.csv
(base) [c-xwu000:dataPrepare]#python3.7 checkFileExist.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
total 560 IDs in /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
total 3252 OD volumes in /home/hxie1/data/BES_3K/W512NumpyVolumes
find 559 corresponding volumes with ID
NonExistIDList: ['367']
total 1 IDs nonexist
output /home/hxie1/data/BES_3K/GTs/testID_delNonExist_final.csv

Final dataset division in the *_final.csv
train: 2031; validation: 546;  Test: 559;

# Oct 5th, 2020
(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_final.csv hypertension_bp_plus_history$ binary
total 2031 raw IDs in file /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_final.csv
values for hypertension_bp_plus_history$ have 2031 records
0 rate: 0.4441161989167898; 1 rate: 0.5558838010832102

total 546 raw IDs in file /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_final.csv
values for hypertension_bp_plus_history$ have 546 records
0 rate: 0.45054945054945056; 1 rate: 0.5494505494505495

(base) [c-xwu000:dataPrepare]#python3.7 statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist_final.csv hypertension_bp_plus_history$ binary
total 559 raw IDs in file /home/hxie1/data/BES_3K/GTs/testID_delNonExist_final.csv
values for hypertension_bp_plus_history$ have 559 records
0 rate: 0.44364937388193204; 1 rate: 0.556350626118068



# Oct 6th, 2020
tail a small dataset for pretrain
train: 200, validation: 50
which are extracted from the first 200, and first 50 from the final dataset.
(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_final_small.csv hypertension_bp_plus_history$ binary
total 200 raw IDs in file /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_final_small.csv
values for hypertension_bp_plus_history$ have 200 records
0 rate: 0.36; 1 rate: 0.64

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_final_small.csv hypertension_bp_plus_history$ binary
total 50 raw IDs in file /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_final_small.csv
values for hypertension_bp_plus_history$ have 50 records
0 rate: 0.28; 1 rate: 0.72

# Oct 8th, 2020
delNonExist_final data:
training: 2031;  0: 44.4%;  1: 55.6%;
validation: 546; 0: 45.1%;  1: 54.9%;
test:     559;   0: 44.4%;  1: 55.6%;

A brief:
1 It needs 40 mins training for one epoch with an input of 31 slices per patients; It is unrealistic for training;
2 data set:
  training: 2031;  0: 44.4%;  1: 55.6%;
  validation: 546; 0: 45.1%;  1: 54.9%;
   test:     559;   0: 44.4%;  1: 55.6%;
3 Now I changed input as one middle slice of 31 slices of OD eye,
  it need one minute per epoch for VGG network; and 0.5 min per peoch for mobileNetV3;
4 Using mobileNet V3, it can get training accuracy 100% in about 400 epochs; but validation accuracy get stuck at 60%;
5 It shows nework at training, but overfiting, which is difefrent from Ovarian cancer project;
6 In future 2 days, I will spent time to reduce its overfitting;

If you are available, you may tell me your time when I can show some training result to you.

# Oct 8th, 2020
Experiment Analysis: for center slice as Input=====================================================================================
            Network                 Pooling     InputActivation LR     dropout  weightDecay    FC            OutputC     trainAccGet70%  trainAccGet100%  validation
20201008_A: Conv2DFeatureNet        Avg         True            0.1    0.5      None        [512, 256, 1]   1024        96              166             57% first big oscillaltion, plane
20201008_B: MobileNetV3_OCT2SysD    Avg         True            0.001  0.5      None        [512, 256, 1]   1024        272             418             56% small oscillation
20201008_C: MobileNetV3_OCT2SysD    Avg         False           0.01   0.5      1e-5        [512, 256, 1]   1024        29              160             57% later stable
20201008_D: Conv2DFeatureNet        Avg         False           0.1    0.5      None        [512, 256, 1]   1024        107             176             56% oscillation
20201008_G: MobileNetV3_OCT2SysD    Avg         False           0.01   0.5*2    1e-4        [512, 256, 1]   1024        29              121             55% oscillation ;  this is improved version of _C.
20201008_H: MobileNetV3_OCT2SysD    Avg         False           0.01   0.8      1e-3        [512,1]         1024        18              101             56% later stable;
20201009_A: moibleNetv3_small       Avg         False           0.01   0.5      1e-2        [64,1]          128         8               40              55% oscillation;
20201009_B: mobileNetv3_small       Max         False           0.01   0.8      1e-1        [64,1]          128         INF             INF             55%, (looks underfitting)
20201009_C: mobileNetv3_small       Max         False           0.01   0.5      1e-2        [64,1]          128         18              134             52%
*20201009_D: mobileNetv3_small       Max         False           0.01   0.8      1e-2        [64,1]          128         27              130             57.69% (Good basis)
20201009_E: mobileNetv3_small       Max         False           0.01   0.5      1e-1        [64,1]          128         INF             INF             55%, majority
20201009_F: mobileNetv3_small       Avg         False           0.01   0.5      1e-1        [64,1]          128         17              INF             55%, majority
20201009_G: mobileNetv3_small       Max         False           0.01   0.2      1e-1        [64,1]          128         INF             INF             55%, majority
20201009_H: mobileNetv3_small       Avg         False           0.01   0.8      1e-2        [64,1]          128         10              64              58%
20201009_I: mobileNetv3_small       IQR         False           0.01   0.8      1e-2        [64,1]          128         37              105             58%
20201009_J: mobileNetv3_small       Max         False           0.01   0.8      1e-2        [48,1]          96          29              127             53%
20201009_K: mobileNetv3_small       Avg         False           0.01   0.8      1e-2        [48,1]          96          11              70              57%
20201009_L: mobileNetv3_small       Avg         False           0.01   0.8      1e-2        [24,1]          48          9               135             56%
20201009_M: mobileNetv3_small       Max         False           0.01   0.8      1e-2        [24,1]          48          44              600             56%
20201009_N: mobileNetv3_small       Max         False           0.01   0.2      1e-2        [12,1]          24          26              153             54%
20201009_O: mobileNetv3_small       Avg         False           0.01   0.2      1e-2        [12,1]          24          8               74              57%
20201009_P: mobileNetv3_small       Max         False           0.01   0.2      1e-2        [1]             48          18              100             57%
20201009_Q: mobileNetv3_small       Max         False           0.01   0.2      1e-2        [1]             24          22              182             58% (Good result)
20201009_R: mobileNetv3_small       Avg         False           0.01   0.2      1e-2        [1]             12          5               70%             57%

Comparison:    OCT2SysD                OvarianCancer
data Size:      3136                    168
predict:        judge current status;   Predict future;
Image model:    Similar;                Various, Each patient cancer is unique;
Classification: Binary;                 Binary;
Network:        MobileNetV3;            MobileNetV3;


# Oct 10th, 2020
Use randoom single slice as input to network:

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv hypertension_bp_plus_history$  binary
total 2034 raw IDs in file /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
values for hypertension_bp_plus_history$ have 2034 records
0 rate: 0.443952802359882; 1 rate: 0.556047197640118

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv hypertension_bp_plus_history$  binary
total 548 raw IDs in file /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv
values for hypertension_bp_plus_history$ have 548 records
0 rate: 0.4489051094890511; 1 rate: 0.551094890510949

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv hypertension_bp_plus_history$  binary
total 560 raw IDs in file /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
values for hypertension_bp_plus_history$ have 560 records
0 rate: 0.44285714285714284; 1 rate: 0.5571428571428572

delNonExist data:
training: 2034;  0: 44.4%;  1: 55.6%;
validation: 548; 0: 44.9%;  1: 55.1%;
test:     560;   0: 44.3%;  1: 55.7%;

delete W=384 image ID:
(base) [c-xwu000:dataPrepare]#python3.7 ./deleteNonStdID.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
deleted 1 IDs in /home/hxie1/data/BES_3K/GTs/trainID_delNonExist.csv
(base) [c-xwu000:dataPrepare]#python3.7 ./deleteNonStdID.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist.csv
No ID deleted.
(base) [c-xwu000:dataPrepare]#python3.7 ./deleteNonStdID.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
deleted 1 IDs in /home/hxie1/data/BES_3K/GTs/testID_delNonExist.csv
(base) [c-xwu000:dataPrepare]#

20201010, statistics data distribution, with deleting error width ID
training: 2033;  0: 44.4%;  1: 55.6%;
validation: 548; 0: 44.9%;  1: 55.1%;
test:     559;   0: 44.4%;  1: 55.6%;

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID.csv hypertension_bp_plus_history$ binary
total 2033 raw IDs in file /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID.csv
values for hypertension_bp_plus_history$ have 2033 records
0 rate: 0.4441711756025578; 1 rate: 0.5558288243974422

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID.csv hypertension_bp_plus_history$ binary
total 548 raw IDs in file /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID.csv
values for hypertension_bp_plus_history$ have 548 records
0 rate: 0.4489051094890511; 1 rate: 0.551094890510949

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID.csv hypertension_bp_plus_history$ binary
total 559 raw IDs in file /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID.csv
values for hypertension_bp_plus_history$ have 559 records
0 rate: 0.44364937388193204; 1 rate: 0.556350626118068

=================Use Random Slice as input to Network on Oct 10th, 2020================================================================================================
            Network                 Pooling     InputActivation LR     LRPatience   dropout  weighDecay    FC            OutputC     trainAccGet60%  trainAccGet70%     trainAccGet100%    validation
20201010_A: mobileNetv3_small       Avg         False           0.01   3             0.2     1e-2          [1]           12          150                                                   max60%
20201010_B: mobileNetv3_small       Avg         False           0.01   3             0.8     1e-2          [64,1]        128         161                                                   max60%
20201010_C: mobileNetv3_small       Avg         False           0.01   30            0.2     1e-2          [1]           12          75               1.8K                                 max61.5%
20201010_D: mobileNetv3_small       Avg         False           0.01   30            0.8     1e-2          [64,1]        128         100                                                   max62%

Oct 13th, 2020 13:29
Current running program:
(base) [c-xwu000:network]#ps 941 938 615 642
GPU   PID TTY      STAT   TIME COMMAND
2     615 ?        Rl   9161:56 python3.7 ./OCT2SysD_Train.py ../testConfig/expOCT2SysD_20201012_A.yaml
3     642 ?        Rl   8672:33 python3.7 ./OCT2SysD_Train.py ../testConfig/expOCT2SysD_20201012_B.yaml
1     938 ?        Rl   29848:39 python3.7 ./OCT2SysD_Train.py ../testConfig/expOCT2SysD_20201010_C.yaml
0     941 ?        Rl   29842:02 python3.7 ./OCT2SysD_Train.py ../testConfig/expOCT2SysD_20201010_D.yaml

=================Use Random Slice as input to Network on Oct 10th, 2020, with batch size 107 ========================================================================
            Network                 Pooling     InputActivation LR     LRPatience LrDecayFactor  dropout  weighDecay    FC            OutputC     trainAccGet60%  trainAccGet80%     trainAccGet100%    validation
20201012_A: mobileNetv3_small       Avg         False           0.1    62         0.826          0.8     1e-2          [512,256,1]    1024        50                                                   max60%
20201012_B: mobileNetv3_small       Avg         False           0.1    62         0.826          0.8     1e-2          [256,128,1]    512         36                                                   max61.68%
20201015_A: mobile_small(pretrain)  Avg         False           0.1    5          0.8            0.5     1e-3          [256,128,1]    512         Inf oscillation at 55%
20201015_B: mobileNetv2_small       Avg         False           0.1    5          0.8            0.5     1e-3          [256,128,1]    512         28              INf                                  58%(max60%)
20201015_C: mobileNetv2_small       Avg         False           0.1    4          0.8            0.2     1e-4          [256,128,1]    512         Inf             INf                                  55%
20201016_A: large                   Avg         False           0.1    5          0.8            0.2     1e-4          [512,256,1]    1024        ===Stop===
20201016_B: large (NoGauss)         Avg         False           0.1    5          0.8            0.3     1e-5          [512,256,1]    1024        40                                                   60%
            Above: when validation ACC gets 60%, its TPR 61.5%, TNR 58.5%, threshold 0.5027

# below expeiment add gaussian and salt pepper noise:
            Network            Notes     Pooling     InputActivation LR     LRPatience LrDecayFactor  dropout  weighDecay    FC            OutputC     trainingAcc  validation
20201017_A: Large                        Avg         False           0.1    6          0.8            0       1e-5          [512,256,1]    1024        63%          ACC61%,TNR45%; TPR75%; Threshold0.44;
20201017_B: Large(No flip aug)           Avg         False           0.1    6          0.8            0       1e-5          [512,256,1]    1024        64%          ACC61%,TNR48%; TPR72%; Threshold0.48;
20201017_C: large                        Avg         False           0.1    6          0.8            0.2     1e-5          [512,256,1]    1024        63.8%        ACC62%,TNR49%; TPR73%; Threshold0.44; (best)
            batchsize=40
20201017_D: Large                        Avg         False           0.1    6          0.8            0.5     1e-5          [512,256,1]    1024        63%          ACC61%,TNR51%; TPR69%; Threshold0.45;
20201019_A: Conv2DFeatureNet             Avg         False           0.1    6          0.8            0.2     1e-5          [512,256,1]    1024
            batchsize =20
20201019_B: Conv2DFeatureNet  ValidAug   Avg         False           0.1    6          0.8            0.2     1e-5          [512,256,1]    1024
            bathsize =20

# Oct 17th, 2020:
for 20201016_B: 4min /epoch

# Oct 20th, 2020:
exclude some patients with disease like below:
1. High myopia (Axiallength_26_ormore_exclude$ =1)
2. Glaucoma (Glaucoma_exclude$ =1)
3. Macula or retinal diseases (Retina_exclude$=1)

tag: excludeMGM (Myopia, Glaucoma, Macula disease)
(base) [c-xwu000:dataPrepare]#python3.7 ./excludeMyopiaGlaucomaMaculaD4.py  /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID.csv
deleted 57 IDs in /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID.csv
(base) [c-xwu000:dataPrepare]#python3.7 ./excludeMyopiaGlaucomaMaculaD4.py  /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID.csv
deleted 67 IDs in /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID.csv
(base) [c-xwu000:dataPrepare]#python3.7 ./excludeMyopiaGlaucomaMaculaD4.py  /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID.csv
deleted 226 IDs in /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID.csv
(base) [c-xwu000:dataPrepare]#

After deleting MGM,  statistic hypertension:

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID_excludeMGM.csv  hypertension_bp_plus_history$ binary
total 1807 raw IDs in file /home/hxie1/data/BES_3K/GTs/trainID_delNonExist_delErrWID_excludeMGM.csv
values for hypertension_bp_plus_history$ have 1807 records
0 rate: 0.4565578306585501; 1 rate: 0.54344216934145

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID_excludeMGM.csv  hypertension_bp_plus_history$ binary
total 481 raw IDs in file /home/hxie1/data/BES_3K/GTs/validationID_delNonExist_delErrWID_excludeMGM.csv
values for hypertension_bp_plus_history$ have 481 records
0 rate: 0.45322245322245325; 1 rate: 0.5467775467775468

(base) [c-xwu000:dataPrepare]#python3.7 ./statisticsDataSet.py /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID_excludeMGM.csv  hypertension_bp_plus_history$ binary
total 502 raw IDs in file /home/hxie1/data/BES_3K/GTs/testID_delNonExist_delErrWID_excludeMGM.csv
values for hypertension_bp_plus_history$ have 502 records
0 rate: 0.4342629482071713; 1 rate: 0.5657370517928287

after delete MGM cases: high myopia, Glaucoma, Macula/Retina disease cases:

    dataset		&number &tag0  	&tag1 \\
	training	&1807  	&45.66\% &54.34\%  \\
	validation	&481  	&45.32\% &54.68\%  \\
	test		&502  	&43.43\% &56.57\%  \\

total: 2790 cases.


            Network            Notes     Pooling     InputActivation LR     LRPatience LrDecayFactor  dropout  weighDecay    FC            OutputC     trainingAcc  validation
20201020_A: large                        Avg         False           0.1    6          0.8            0.2     1e-5          [512,256,1]    1024         61%(max)    ACC61%,TNR53%; TPR68%; Threshold0.48;
            batchSize=40
            Validation Augment
            GPU=3

20201020_B: Conv2DFeatureNet             Avg         False           0.1    6          0.8            0.2     1e-5          [512,256,1]    1024        51%          55%(stop)
            bathsize =20
            Validation Augment
            GPU=2
20201020_C: large                        Avg         False           0.5    6          0.8            0.2     1e-5          [512,256,1]    1024        64%(max)     ACC61%,TNR51%; TPR69%; Threshold0.48;
            batchSize=40
            Validation Augment
            GPU=3

20201020_D: Conv2DFeatureNet             Avg         False           0.5    6          0.8            0.2     1e-5          [512,256,1]    1024        61%          57%(stop)
            bathsize =20
            Validation Augment
            GPU=2

20201021_A: large                        Avg         False           1      6          0.8            0.2     1e-5          [512,256,1]    1024       65%(max)      ACC63%,TNR56%; TPR68%; Threshold0.49; (best)
            batchSize=40
            Validation Augment
            GPU=0
            LR=1

20201022_A: large                        Avg         False           2      6           0.8            0.2     1e-5          [512,256,1]    1024      64%(max)      ACC61%,TNR59%; TPR63%; Threshold0.50;
            batchSize=40
            Validation Augment
            GPU=1
            LR=2
            LrSchedular uses sum.

20201022_B: large                        Avg         False           1      6           0.8            0.2     1e-5          [512,256,1]    1024      65(max)       ACC62%,TNR50%; TPR71%; Threshold0.50;             batchSize=40
            Validation Augment
            GPU=2
            LR=1
            LrSchedular uses sum.