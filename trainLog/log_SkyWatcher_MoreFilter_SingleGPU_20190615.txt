Program ID of SkyWatcher Network training:3748

Program command: 
 ['TrainSkyWatcher.py', '/home/hxie1/temp_netParameters/OvarianCancer/SkyWatcher', '/home/hxie1/data/OvarianCancerCT/Extract_ps2_2_5/Images_ROI_29_140_140', '/home/hxie1/data/OvarianCancerCT/Extract_ps2_2_5/Labels_ROI_23_127_127', '/home/hxie1/data/OvarianCancerCT/patientResponseDict.json']

Major program changes: 
                      merge train and test dataMgr into one.
                      when epoch %5 ==0, do not use mixup.
                      And Only when epoch %5 ==0, print log and save.
                      Along the encoder, use more filters. And the first layer has 32 filters.
                      Use BatchNorm1d in FC layer, instead of InstanceNorm1d.
                      

Experiment setting for Image3d ROI to response:
Input CT data: 29*140*140  3D CT raw image ROI with spacing size(5*2*2)
segmentation label: 23*127*127 with spacing size(5*2*2) segmentation label with value (0,1,2) which erases lymph node label

This is a multi-task learning. 

Predictive Model: 1,  first 3-layer dense conv block with channel size 128.
                  2,  and 3 dense conv DownBB blocks,  each of which includes a stride 2 conv and 3-layers dense conv block; 
                  3,  and 3 fully connected layers  changes the tensor into size 2*1;
                  4,  final a softmax for binary classification;
                  Total network learning parameters are 8 million.
                  Network architecture is referred at https://github.com/Hui-Xie/OvarianCancer/blob/master/SkyWatcherModel.py

response Loss Function:   focus loss  with weight [3.3, 1.4] for [0,1] class separately, as [0,1] uneven distribution.
segmentation loss function: focus loss  with weight [1.0416883685076772, 39.37007874015748, 68.39945280437757] for label (0, 1, 2)

Data:   training data has 113 patients, and valdiation data has 27 patients with training/test rate 80/20.
        We randomize all data, and then assign same distrubtion of treat reponse 0,1 into to training and test data set.
        

Training strategy:  50% probability of data are mixed up with beta distribution with alpha =0.4, to feed into network for training. 
                    No other data augmentation, and no dropout.  

                    Learning Scheduler:  Reduce learning rate on  plateau, and learning rate patience is 30 epochs.                                

            

Program starting Time: 2019-06-15 08:24:27.420218
Info: netPath = /home/hxie1/temp_netParameters/OvarianCancer/SkyWatcher

Now program get 140 input files.
Infor: In all data of 140 files, respone 0 has 41 files,
	  and response 1 has 99 files, where positive response rate = 0.7071428571428572 in full data
==== Regenerate training set and validation set by random with same distribution of 0 and 1 ==== 
Infor: Validation Set has 27 files,and Training Set has 113 files
Infor: In Validataion set, 19 1's, and positive response rate = 0.7037037037037037
Infor: In trainning set, 80 1's,  positive response rate = 0.7079646017699115
Infor: program is in multi samples running model.
TrainTestData Input:  batchSize=4, depth=29, height=140, width=140

Info: the size of bottle neck in the net = (512, 1, 7, 7)

Info: program uses Mixup with alpha=0.4, and mixupProb = 0.5.
Network trains from scratch.
Network has total 21,463,684 parameters.
Infor: Response Cross Entropy Weight: [3.3333333333333335, 1.4285714285714286] for label[0, 1]
Infor: Segmentation Cross Entropy Weight: [1.0416883685076772, 39.37007874015748, 68.39945280437757] for label (0, 1, 2)
Loss Functions List: FocalCELoss with weight of 1; 	FocalCELoss with weight of 1; 
Hints: Test Dice_0 is the dice coeff for all non-zero labels
Hints: Test Dice_1 is for primary cancer(green), 	
 test Dice_2 is for metastasis(yellow), 	
 and test Dice_3 is for invaded lymph node(brown).
Hints: Test TPR_0 is the TPR for all non-zero labels
Hints: Test TPR_1 is for primary cancer(green), 	
 TPR_2 is for metastasis(yellow), 	
 and TPR_3 is for invaded lymph node(brown).

Dice is based on all 2D segmented slices in the volume from weak annotation, not real 3D dice.

Hints: Optimal_Result = Yes = 1,  Optimal_Result = No = 0 

Epoch	TrLoss	Dice0	Dice1	Dice2	TPR_0	TPR_1	TPR_2	Accura	TPR_r	TNR_r		TsLoss	Dice0	Dice1	Dice2	TPR_0	TPR_1	TPR_2	Accura	TPR_r	TNR_r
0	0.7910	0.097	0.082	0.045	0.820	0.235	0.670	0.5446	0.4304	0.8182		1.9442	0.054	0.017	0.048	0.601	0.011	0.732	0.5000	0.3750	0.7500
5	0.6258	0.115	0.166	0.051	0.833	0.605	0.576	0.5268	0.5875	0.3750		0.6989	0.063	0.139	0.043	0.986	0.882	0.907	0.5833	0.7222	0.1667
10	0.5347	0.219	0.286	0.101	0.921	0.578	0.585	0.6339	0.7342	0.3939		0.5194	0.188	0.395	0.103	0.852	0.815	0.593	0.5833	0.8235	0.0000
